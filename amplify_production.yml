version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "ğŸš€ Preparing Centralized Delivery Platform for AWS Amplify"
        - echo "ğŸ“‹ Build Configuration:"
        - echo "   â”œâ”€â”€ Frontend: Static HTML/CSS/JS"
        - echo "   â”œâ”€â”€ Backend: AWS Lambda + API Gateway"
        - echo "   â”œâ”€â”€ Database: AWS RDS PostgreSQL"
        - echo "   â””â”€â”€ API: https://l17hfioxt7.execute-api.eu-north-1.amazonaws.com/api/"
        - echo ""
        - echo "ğŸ“ Setting up static files..."
        - cd fastapi-template/static
        - echo "ğŸ“ Current HTML files:"
        - ls -la *.html
    build:
      commands:
        - echo "ğŸ”§ Configuring frontend for production deployment"
        - echo "ğŸ”— Updating API endpoints to live AWS Lambda backend..."
        - |
          # Update API base URL in all HTML files to point to live Lambda deployment
          find . -name "*.html" -print0 | while IFS= read -r -d '' file; do
            echo "   ğŸ“„ Updating: $file"
            sed -i.bak 's|meta name="api-base" content="[^"]*"|meta name="api-base" content="https://l17hfioxt7.execute-api.eu-north-1.amazonaws.com/api/"|g' "$file"
          done
        - echo "ğŸ§¹ Cleaning up backup files..."
        - find . -name "*.bak" -delete
        - echo "âœ… Frontend configuration complete"
        - echo ""
        - echo "ğŸ“Š Deployment Summary:"
        - echo "   â”œâ”€â”€ Static Files: $(find . -name "*.html" | wc -l) HTML files"
        - echo "   â”œâ”€â”€ Stylesheets: $(find . -name "*.css" | wc -l) CSS files"
        - echo "   â”œâ”€â”€ Scripts: $(find . -name "*.js" | wc -l) JS files"
        - echo "   â””â”€â”€ Total Files: $(find . -type f | wc -l) files"
        - echo ""
        - echo "ğŸŒ Ready for AWS Amplify deployment!"
  artifacts:
    baseDirectory: fastapi-template/static
    files:
      - '**/*'
  cache:
    paths: []
  customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Strict-Transport-Security'
          value: 'max-age=31536000; includeSubDomains'
        - key: 'X-Frame-Options'
          value: 'DENY'
        - key: 'X-Content-Type-Options'
          value: 'nosniff'
        - key: 'Referrer-Policy'
          value: 'strict-origin-when-cross-origin'
        - key: 'Cache-Control'
          value: 'public, max-age=31536000, immutable'
    - pattern: '*.html'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=0, must-revalidate'
    - pattern: '/login*'
      headers:
        - key: 'Cache-Control'
          value: 'no-cache, no-store, must-revalidate'
