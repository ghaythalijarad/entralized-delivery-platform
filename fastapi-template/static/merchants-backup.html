<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=yes, minimum-scale=1, maximum-scale=5">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>إدارة التجار - النظام المركزي</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        body {
            background: #f4f6fb;
            font-family: 'Segoe UI', 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Mobile-first responsive containers */
        .container-fluid {
            padding: 1rem;
        }
        
        @media (min-width: 768px) {
            .container-fluid {
                padding: 1.5rem 2rem;
            }
        }
        
        @media (min-width: 992px) {
            .container-fluid {
                padding: 2rem 3rem;
            }
        }
        
        /* Enhanced merchant card design */
        .merchant-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 1rem;
        }
        
        .merchant-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 767.98px) {
            .merchant-card {
                margin-bottom: 1rem;
            }
            
            .merchant-card .card-body {
                padding: 1rem;
            }
        }
        
        /* Mobile-responsive merchant grid */
        .merchant-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        @media (min-width: 576px) {
            .merchant-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 992px) {
            .merchant-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 1200px) {
            .merchant-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Status indicators */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 5px;
        }
        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
        .status-busy { background-color: #ffc107; }
        
        /* Avatar styling */
        .avatar-circle {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        @media (max-width: 767.98px) {
            .avatar-circle {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }
        
        /* Responsive metric cards */
        .metric-card {
            border: none;
            border-radius: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 767.98px) {
            .metric-card .card-body {
                padding: 1rem;
                text-align: center;
            }
            
            .metric-card h3 {
                font-size: 1.5rem;
            }
        }
        
        /* Mobile-friendly filter section */
        .filter-section {
            background: #fff;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        @media (min-width: 768px) {
            .filter-section {
                padding: 1.5rem;
            }
        }
        
        .filter-section .form-control,
        .filter-section .form-select {
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        @media (min-width: 768px) {
            .filter-section .form-control,
            .filter-section .form-select {
                margin-bottom: 0;
            }
        }
        
        /* Mobile-optimized buttons */
        .btn {
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-weight: 500;
        }
        
        @media (max-width: 767.98px) {
            .btn {
                padding: 0.625rem 0.875rem;
                font-size: 0.9rem;
            }
            
            .btn-group-mobile {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .btn-group-mobile .btn {
                width: 100%;
            }
        }
        
        @media (min-width: 768px) {
            .btn-group-mobile {
                display: flex;
                flex-direction: row;
                gap: 0.5rem;
            }
        }
        
        /* Responsive table alternatives */
        @media (max-width: 767.98px) {
            .table-responsive {
                display: none;
            }
            
            .mobile-merchant-card {
                background: #fff;
                border-radius: 12px;
                padding: 1rem;
                margin-bottom: 1rem;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                border: 1px solid #f1f3f4;
            }
            
            .mobile-merchant-header {
                display: flex;
                align-items: center;
                margin-bottom: 1rem;
                padding-bottom: 1rem;
                border-bottom: 1px solid #f1f3f4;
            }
            
            .mobile-merchant-info {
                margin-right: 1rem;
                flex: 1;
            }
            
            .mobile-merchant-details {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
                margin-bottom: 1rem;
                font-size: 0.9rem;
            }
            
            .mobile-merchant-field {
                display: flex;
                flex-direction: column;
            }
            
            .mobile-merchant-label {
                font-weight: 600;
                color: #666;
                font-size: 0.8rem;
                margin-bottom: 0.25rem;
            }
            
            .mobile-merchant-value {
                color: #333;
            }
            
            .mobile-merchant-actions {
                display: flex;
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            
            .mobile-merchant-actions .btn {
                flex: 1;
                min-width: 100px;
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
            }
        }
        
        @media (min-width: 768px) {
            .mobile-merchants {
                display: none;
            }
        }
        
        /* Modal responsiveness */
        @media (max-width: 767.98px) {
            .modal-dialog {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }
            
            .modal-content {
                border-radius: 12px;
            }
            
            .modal-header,
            .modal-body,
            .modal-footer {
                padding: 1rem;
            }
            
            .modal-title {
                font-size: 1.1rem;
            }
        }
        
        /* Touch-friendly interactions */
        @media (hover: none) {
            .merchant-card:hover {
                transform: none;
            }
            
            .merchant-card:active,
            .mobile-merchant-card:active {
                transform: scale(0.98);
                transition: transform 0.1s;
            }
            
            .btn:hover {
                transform: none;
            }
            
            .btn:active {
                transform: scale(0.98);
            }
        }
        
        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Focus states */
        .merchant-card:focus-within,
        .mobile-merchant-card:focus-within,
        .filter-section:focus-within {
            outline: 2px solid #1976d2;
            outline-offset: 2px;
        }
        
        /* Enhanced responsive typography */
        h1, h2, h3, h4, h5, h6 {
            line-height: 1.3;
        }
        
        @media (max-width: 767.98px) {
            h2 {
                font-size: 1.5rem;
            }
            
            h5 {
                font-size: 1.1rem;
            }
        }
        
        /* Responsive spacing utilities */
        @media (max-width: 767.98px) {
            .mb-4 {
                margin-bottom: 1.5rem !important;
            }
            
            .p-4 {
                padding: 1rem !important;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid p-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>إدارة التجار و تطبيق التجار</h2>
            <div>
                <button class="btn btn-outline-success me-2" onclick="exportMerchants()">
                    <span class="material-icons-outlined me-1">download</span>
                    تصدير البيانات
                </button>
                <button class="btn btn-outline-info me-2" onclick="downloadMerchantApp()">
                    <span class="material-icons-outlined me-1">download</span>
                    تحميل تطبيق التجار APK
                </button>
                <button class="btn btn-primary" onclick="showAddMerchantModal()">
                    <span class="material-icons-outlined me-1">store</span>
                    إضافة تاجر جديد
                </button>
            </div>
        </div>

        <!-- App Status Alert -->
        <div class="alert alert-light border mb-4">
            <div class="d-flex align-items-center">
                <span class="material-icons-outlined text-success me-2">phone_android</span>
                <div class="flex-grow-1">
                    <strong>تطبيق التجار:</strong> يتلقى الطلبات من النظام المركزي ويرسل تحديثات الحالة
                    <br><small class="text-muted">آخر إصدار: v2.1.0 | عدد التجار المتصلين: <span id="onlineMerchants">18</span> من <span id="totalMerchants">23</span></small>
                </div>
                <button class="btn btn-outline-primary btn-sm" onclick="sendBulkNotification()">إرسال إشعار جماعي</button>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card metric-card text-center">
                    <div class="card-body">
                        <span class="material-icons-outlined" style="font-size: 3rem;">store</span>
                        <h3 class="mt-2" id="activeMerchantsCount">23</h3>
                        <p class="mb-0">إجمالي التجار</p>
                        <small>+3 هذا الأسبوع</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card text-center">
                    <div class="card-body">
                        <span class="material-icons-outlined" style="font-size: 3rem;">wifi</span>
                        <h3 class="mt-2" id="onlineMerchantsCount">18</h3>
                        <p class="mb-0">متصل الآن</p>
                        <small>78% معدل الاتصال</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card text-center">
                    <div class="card-body">
                        <span class="material-icons-outlined" style="font-size: 3rem;">receipt_long</span>
                        <h3 class="mt-2" id="totalOrdersCount">1,247</h3>
                        <p class="mb-0">إجمالي الطلبات</p>
                        <small>هذا الشهر</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card text-center">
                    <div class="card-body">
                        <span class="material-icons-outlined" style="font-size: 3rem;">star</span>
                        <h3 class="mt-2" id="averageRating">4.6</h3>
                        <p class="mb-0">متوسط التقييم</p>
                        <small>من 1,892 تقييم</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter and Search Section -->
        <div class="filter-section">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">البحث</label>
                    <div class="input-group">
                        <span class="input-group-text">
                            <span class="material-icons-outlined">search</span>
                        </span>
                        <input type="text" class="form-control" id="searchInput" placeholder="اسم التاجر، الهاتف، أو الرقم">
                    </div>
                </div>
                <div class="col-md-2">
                    <label class="form-label">الحالة</label>
                    <select class="form-select" id="statusFilter">
                        <option value="">جميع الحالات</option>
                        <option value="online">متصل</option>
                        <option value="offline">غير متصل</option>
                        <option value="suspended">معلق</option>
                        <option value="pending">قيد المراجعة</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">فئة النشاط</label>
                    <select class="form-select" id="categoryFilter">
                        <option value="">جميع الفئات</option>
                        <option value="store">متجر</option>
                        <option value="betshop">محل رهانات</option>
                        <option value="restaurant">مطعم</option>
                        <option value="pharmacy">صيدلية</option>
                        <option value="giftshop">محل هدايا</option>
                        <option value="electronics">إلكترونيات</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">التقييم</label>
                    <select class="form-select" id="ratingFilter">
                        <option value="">جميع التقييمات</option>
                        <option value="5">⭐⭐⭐⭐⭐ (5 نجوم)</option>
                        <option value="4">⭐⭐⭐⭐ (4+ نجوم)</option>
                        <option value="3">⭐⭐⭐ (3+ نجوم)</option>
                        <option value="2">⭐⭐ (2+ نجوم)</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">ترتيب حسب</label>
                    <select class="form-select" id="sortBy">
                        <option value="name">الاسم</option>
                        <option value="rating">التقييم</option>
                        <option value="orders">عدد الطلبات</option>
                        <option value="joinDate">تاريخ الانضمام</option>
                        <option value="lastActive">آخر نشاط</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label class="form-label">&nbsp;</label>
                    <button class="btn btn-primary w-100" onclick="applyFilters()">
                        <span class="material-icons-outlined">filter_list</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Merchants Table -->
        <div class="row">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">قائمة التجار (<span id="filteredCount">23</span> تاجر)</h5>
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="viewMode" id="tableView" checked>
                            <label class="btn btn-outline-secondary" for="tableView">
                                <span class="material-icons-outlined">table_rows</span>
                            </label>
                            <input type="radio" class="btn-check" name="viewMode" id="cardView">
                            <label class="btn btn-outline-secondary" for="cardView">
                                <span class="material-icons-outlined">view_module</span>
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Table View -->
                        <div id="tableViewContent">
                            <div class="table-responsive">
                                <table class="table table-hover" id="merchantsTable">
                                    <thead class="table-light">
                                        <tr>
                                            <th>
                                                <input type="checkbox" class="form-check-input" id="selectAll">
                                            </th>
                                            <th>التاجر</th>
                                            <th>الفئة</th>
                                            <th>الهاتف</th>
                                            <th>الطلبات</th>
                                            <th>التقييم</th>
                                            <th>الحالة</th>
                                            <th>آخر نشاط</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="merchantsTableBody">
                                        <!-- Dynamic content will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Card View -->
                        <div id="cardViewContent" style="display: none;">
                            <div class="row" id="merchantsCardContainer">
                                <!-- Dynamic card content will be loaded here -->
                            </div>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Merchants pagination" class="mt-4">
                            <ul class="pagination justify-content-center" id="pagination">
                                <!-- Dynamic pagination will be loaded here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Merchant Modal -->
    <div class="modal fade" id="addMerchantModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة تاجر جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addMerchantForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">اسم المتجر</label>
                                    <input type="text" class="form-control" id="storeName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">اسم المالك</label>
                                    <input type="text" class="form-control" id="ownerName" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">رقم الهاتف</label>
                                    <input type="tel" class="form-control" id="phoneNumber" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">البريد الإلكتروني</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">فئة النشاط</label>
                                    <select class="form-select" id="businessCategory" required>
                                        <option value="">اختر الفئة</option>
                                        <option value="store">متجر</option>
                                        <option value="betshop">محل رهانات</option>
                                        <option value="restaurant">مطعم</option>
                                        <option value="pharmacy">صيدلية</option>
                                        <option value="giftshop">محل هدايا</option>
                                        <option value="electronics">إلكترونيات</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">رقم السجل التجاري</label>
                                    <input type="text" class="form-control" id="commercialRegister" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">العنوان</label>
                            <textarea class="form-control" id="address" rows="3" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">خط الطول</label>
                                    <input type="number" class="form-control" id="longitude" step="any" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">خط العرض</label>
                                    <input type="number" class="form-control" id="latitude" step="any" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">وصف المتجر</label>
                            <textarea class="form-control" id="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">نسبة عمولة المنصة (%)</label>
                            <input type="number" class="form-control" id="commissionPercent" min="0" max="100" step="0.1" value="10" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="addMerchant()">إضافة التاجر</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Merchant Details Modal -->
    <div class="modal fade" id="merchantDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">تفاصيل التاجر</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="merchantDetailsContent">
                    <div class="row">
                        <div class="col-12">
                            <h6 class="mb-3">منتجات المتجر</h6>
                            <div class="row" id="merchantItemsList">
                                <!-- Dynamic merchant items will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Merchant Items Management Modal -->
    <div class="modal fade" id="merchantItemsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">منتجات وعناصر المتجر</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h6 class="mb-0">جميع المنتجات المتاحة</h6>
                        <div>
                            <button class="btn btn-outline-info btn-sm" onclick="bulkUpdatePrices()">
                                <span class="material-icons-outlined me-1">edit</span>
                                تحديث الأسعار بالجملة
                            </button>
                        </div>
                    </div>
                    
                    <!-- Items Filter -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="itemSearchInput" placeholder="البحث في المنتجات...">
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="itemCategoryFilter">
                                <option value="">جميع الفئات</option>
                                <option value="food">طعام</option>
                                <option value="drinks">مشروبات</option>
                                <option value="medicine">أدوية</option>
                                <option value="electronics">إلكترونيات</option>
                                <option value="gifts">هدايا</option>
                                <option value="sports">رياضة</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="itemStatusFilter">
                                <option value="">جميع الحالات</option>
                                <option value="available">متاح</option>
                                <option value="out_of_stock">نفذ المخزون</option>
                                <option value="discontinued">متوقف</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary w-100" onclick="filterItems()">تصفية</button>
                        </div>
                    </div>

                    <!-- Items Table -->
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>المنتج</th>
                                    <th>الفئة</th>
                                    <th>السعر</th>
                                    <th>المخزون</th>
                                    <th>الحالة</th>
                                    <th>التقييم</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="merchantItemsTableBody">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" onclick="saveItemsChanges()">حفظ التغييرات</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div class="modal fade" id="addEditItemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addEditItemTitle">إضافة منتج جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="itemForm">
                        <input type="hidden" id="itemId">
                        <input type="hidden" id="merchantId">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">اسم المنتج</label>
                                    <input type="text" class="form-control" id="itemName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">الفئة</label>
                                    <select class="form-select" id="itemCategory" required>
                                        <option value="">اختر الفئة</option>
                                        <option value="food">طعام</option>
                                        <option value="drinks">مشروبات</option>
                                        <option value="medicine">أدوية</option>
                                        <option value="electronics">إلكترونيات</option>
                                        <option value="gifts">هدايا</option>
                                        <option value="sports">رياضة</option>
                                        <option value="other">أخرى</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">وصف المنتج</label>
                            <textarea class="form-control" id="itemDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">السعر (ر.س)</label>
                                    <input type="number" class="form-control" id="itemPrice" step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">الكمية المتاحة</label>
                                    <input type="number" class="form-control" id="itemStock" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">الحد الأدنى للمخزون</label>
                                    <input type="number" class="form-control" id="itemMinStock" min="0" value="5">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">الحالة</label>
                                    <select class="form-select" id="itemStatus" required>
                                        <option value="available">متاح</option>
                                        <option value="out_of_stock">نفذ المخزون</option>
                                        <option value="discontinued">متوقف</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">وقت التحضير (دقيقة)</label>
                                    <input type="number" class="form-control" id="itemPrepTime" min="1" value="15">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">الوزن (جرام)</label>
                                    <input type="number" class="form-control" id="itemWeight" min="0" step="0.1">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">السعرات الحرارية</label>
                                    <input type="number" class="form-control" id="itemCalories" min="0">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">رابط الصورة</label>
                            <input type="url" class="form-control" id="itemImageUrl" placeholder="https://example.com/image.jpg">
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="itemFeatured">
                                <label class="form-check-label" for="itemFeatured">
                                    منتج مميز
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الكلمات المفتاحية (مفصولة بفواصل)</label>
                            <input type="text" class="form-control" id="itemTags" placeholder="برجر، دجاج، حار">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="saveItem()">حفظ المنتج</button>
                </div>
            </div>
        </div>
    </div>

    <!-- No code changes needed to test the website. Please follow these steps: -->

<!-- 1. Make sure your server is running -->
<!-- In terminal: -->
<!-- cd "/Users/ghaythallaheebi/centralized platform/fastapi-template/static" -->
<!-- python3 -m http.server 8000 -->

<!-- 2. Open your browser and go to: -->
<!-- http://localhost:8000/merchants.html -->

<!-- 3. You should see the merchants page with test data, commission fields, and item management. -->

<!-- 4. Click on any merchant to view details, commission, and items. -->

<!-- If you see the merchant list and can open merchant details with products and commission, everything is working! -->

<!-- No further code changes required. -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Merchant Management System
        class MerchantManager {
            constructor() {
                this.merchants = [];
                this.filteredMerchants = [];
                this.currentPage = 1;
                this.itemsPerPage = 10;
                this.merchantItems = new Map(); // Store items for each merchant
                this.currentMerchantId = null;
                this.init();
            }

            init() {
                this.loadMerchants();
                this.loadMerchantItems();
                this.setupEventListeners();
                this.setupViewModeToggle();
            }

            setupEventListeners() {
                // Search functionality
                document.getElementById('searchInput').addEventListener('input', () => {
                    this.applyFilters();
                });

                // Filter change events
                ['statusFilter', 'categoryFilter', 'ratingFilter', 'sortBy'].forEach(id => {
                    document.getElementById(id).addEventListener('change', () => {
                        this.applyFilters();
                    });
                });

                // Select all checkbox
                document.getElementById('selectAll').addEventListener('change', (e) => {
                    const checkboxes = document.querySelectorAll('#merchantsTableBody input[type="checkbox"]');
                    checkboxes.forEach(cb => cb.checked = e.target.checked);
                });
            }

            setupViewModeToggle() {
                document.getElementById('tableView').addEventListener('change', () => {
                    if (document.getElementById('tableView').checked) {
                        document.getElementById('tableViewContent').style.display = 'block';
                        document.getElementById('cardViewContent').style.display = 'none';
                    }
                });

                document.getElementById('cardView').addEventListener('change', () => {
                    if (document.getElementById('cardView').checked) {
                        document.getElementById('tableViewContent').style.display = 'none';
                        document.getElementById('cardViewContent').style.display = 'block';
                        this.renderCardView();
                    }
                });
            }

            loadMerchants() {
                // Enhanced test data for merchants with commission and detailed info
                this.merchants = [
                    {
                        id: 'M001',
                        name: 'مطعم الذواقة الشرقي',
                        owner: 'أحمد محمد العلي',
                        category: 'restaurant',
                        phone: '0501234567',
                        email: 'info@restaurant-aldhawaqah.com',
                        orders: 287,
                        rating: 4.8,
                        reviews: 456,
                        status: 'online',
                        lastActive: new Date(),
                        joinDate: new Date('2023-01-15'),
                        address: 'الرياض، حي النرجس، شارع التحلية',
                        location: { lat: 24.7136, lng: 46.6753 },
                        commission: 12,
                        commercialRegister: 'CR-1030456789',
                        totalRevenue: 125600,
                        monthlyRevenue: 18400,
                        description: 'مطعم متخصص في الأطباق العربية التقليدية والشرقية'
                    },
                    {
                        id: 'M002',
                        name: 'متجر الوفرة للمواد الغذائية',
                        owner: 'سارة أحمد المطيري',
                        category: 'store',
                        phone: '0509876543',
                        email: 'info@alwafra-store.com',
                        orders: 445,
                        rating: 4.2,
                        reviews: 189,
                        status: 'offline',
                        lastActive: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000),
                        joinDate: new Date('2023-02-20'),
                        address: 'الرياض، حي الملز، طريق الإمام سعود',
                        location: { lat: 24.6877, lng: 46.7219 },
                        commission: 10,
                        commercialRegister: 'CR-1030567890',
                        totalRevenue: 89300,
                        monthlyRevenue: 12150,
                        description: 'متجر شامل للمواد الغذائية ومستلزمات المنزل'
                    },
                    {
                        id: 'M003',
                        name: 'صيدلية النور الطبية',
                        owner: 'د. محمد سالم الحربي',
                        category: 'pharmacy',
                        phone: '0555123456',
                        email: 'info@alnoor-pharmacy.com',
                        orders: 534,
                        rating: 4.9,
                        reviews: 267,
                        status: 'online',
                        lastActive: new Date(),
                        joinDate: new Date('2023-03-10'),
                        address: 'الرياض، حي العليا، شارع العروبة',
                        location: { lat: 24.6944, lng: 46.6850 },
                        commission: 8,
                        commercialRegister: 'CR-1030678901',
                        totalRevenue: 178900,
                        monthlyRevenue: 24300,
                        description: 'صيدلية طبية متكاملة مع استشارات دوائية'
                    },
                    {
                        id: 'M004',
                        name: 'محل الهدايا الذهبي الفاخر',
                        owner: 'فاطمة خالد السديري',
                        category: 'giftshop',
                        phone: '0557891234',
                        email: 'info@golden-gifts.com',
                        orders: 156,
                        rating: 4.5,
                        reviews: 143,
                        status: 'online',
                        lastActive: new Date(),
                        joinDate: new Date('2023-04-05'),
                        address: 'الرياض، حي الياسمين، برج الياسمين',
                        location: { lat: 24.7225, lng: 46.6890 },
                        commission: 15,
                        commercialRegister: 'CR-1030789012',
                        totalRevenue: 67800,
                        monthlyRevenue: 8900,
                        description: 'متجر هدايا فاخرة ومميزة لجميع المناسبات'
                    },
                    {
                        id: 'M005',
                        name: 'متجر الإلكترونيات الحديث',
                        owner: 'عبدالله أحمد القحطاني',
                        category: 'electronics',
                        phone: '0551239876',
                        email: 'info@modern-electronics.com',
                        orders: 278,
                        rating: 4.3,
                        reviews: 392,
                        status: 'offline',
                        lastActive: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000),
                        joinDate: new Date('2023-03-25'),
                        address: 'الرياض، حي الربيع، مجمع الربيع التجاري',
                        location: { lat: 24.6790, lng: 46.7020 },
                        commission: 7,
                        commercialRegister: 'CR-1030890123',
                        totalRevenue: 234500,
                        monthlyRevenue: 31200,
                        description: 'متجر متخصص في الإلكترونيات والأجهزة الذكية'
                    },
                    {
                        id: 'M006',
                        name: 'محل الرهانات الرياضي الذهبي',
                        owner: 'خالد محمد الدوسري',
                        category: 'betshop',
                        phone: '0558765432',
                        email: 'info@golden-bets.com',
                        orders: 323,
                        rating: 4.1,
                        reviews: 178,
                        status: 'online',
                        lastActive: new Date(),
                        joinDate: new Date('2023-05-12'),
                        address: 'الرياض، حي السلام، مركز السلام التجاري',
                        location: { lat: 24.7100, lng: 46.6950 },
                        commission: 9,
                        commercialRegister: 'CR-1030901234',
                        totalRevenue: 145600,
                        monthlyRevenue: 19800,
                        description: 'محل رهانات رياضية مرخص ومعتمد'
                    },
                    {
                        id: 'M007',
                        name: 'مقهى البن الأصيل',
                        owner: 'عمر عبدالرحمن الشمري',
                        category: 'restaurant',
                        phone: '0543216789',
                        email: 'info@authentic-coffee.com',
                        orders: 198,
                        rating: 4.7,
                        reviews: 234,
                        status: 'online',
                        lastActive: new Date(),
                        joinDate: new Date('2023-06-20'),
                        address: 'الرياض، حي الحمراء، شارع الأمير محمد بن عبدالعزيز',
                        location: { lat: 24.6500, lng: 46.7100 },
                        commission: 11,
                        commercialRegister: 'CR-1031012345',
                        totalRevenue: 89400,
                        monthlyRevenue: 14200,
                        description: 'مقهى متخصص في القهوة العربية الأصيلة والحلويات'
                    },
                    {
                        id: 'M008',
                        name: 'متجر الأزياء العصرية',
                        owner: 'نورا سعد العتيبي',
                        category: 'store',
                        phone: '0556789012',
                        email: 'info@modern-fashion.com',
                        orders: 167,
                        rating: 4.4,
                        reviews: 156,
                        status: 'online',
                        lastActive: new Date(),
                        joinDate: new Date('2023-07-08'),
                        address: 'الرياض، حي الروضة، مجمع الروضة مول',
                        location: { lat: 24.7300, lng: 46.6200 },
                        commission: 13,
                        commercialRegister: 'CR-1031123456',
                        totalRevenue: 112300,
                        monthlyRevenue: 16800,
                        description: 'متجر أزياء نسائية عصرية ومحتشمة'
                    },
                    {
                        id: 'M009',
                        name: 'صيدلية الرحمة الشاملة',
                        owner: 'د. فهد علي الغامدي',
                        category: 'pharmacy',
                        phone: '0559012345',
                        email: 'info@alrahma-pharmacy.com',
                        orders: 412,
                        rating: 4.6,
                        reviews: 298,
                        status: 'suspended',
                        lastActive: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000),
                        joinDate: new Date('2023-04-30'),
                        address: 'الرياض، حي البديعة، شارع الإمام تركي',
                        location: { lat: 24.6600, lng: 46.7400 },
                        commission: 8,
                        commercialRegister: 'CR-1031234567',
                        totalRevenue: 167800,
                        monthlyRevenue: 22100,
                        description: 'صيدلية شاملة مع خدمات طبية متنوعة'
                    },
                    {
                        id: 'M010',
                        name: 'متجر الألعاب الذكية',
                        owner: 'يوسف أحمد المالكي',
                        category: 'giftshop',
                        phone: '0547890123',
                        email: 'info@smart-toys.com',
                        orders: 89,
                        rating: 4.2,
                        reviews: 67,
                        status: 'pending',
                        lastActive: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),
                        joinDate: new Date('2023-08-15'),
                        address: 'الرياض، حي الشفا، مركز الشفا التجاري',
                        location: { lat: 24.7800, lng: 46.6300 },
                        commission: 14,
                        commercialRegister: 'CR-1031345678',
                        totalRevenue: 34500,
                        monthlyRevenue: 8600,
                        description: 'متجر ألعاب تعليمية وذكية للأطفال'
                    }
                ];

                this.filteredMerchants = [...this.merchants];
                this.renderMerchants();
                this.updateStatistics();
            }

            loadMerchantItems() {
                // Enhanced test data for merchant items
                this.merchantItems.set('M001', [
                    {
                        id: 'I001',
                        name: 'برجر دجاج كلاسيكي',
                        category: 'food',
                        description: 'برجر دجاج طري مع خضار طازجة وصوص خاص',
                        price: 25.00,
                        stock: 50,
                        minStock: 5,
                        status: 'available',
                        prepTime: 15,
                        weight: 300,
                        calories: 450,
                        imageUrl: 'https://dummyimage.com/100x100/f4a261/fff&text=برجر',
                        featured: true,
                        tags: ['برجر', 'دجاج', 'حار'],
                        rating: 4.5,
                        reviews: 123,
                        soldCount: 245
                    },
                    {
                        id: 'I002',
                        name: 'بطاطس مقلية كبيرة',
                        category: 'food',
                        description: 'بطاطس مقلية ذهبية مقرمشة مع ملح البحر',
                        price: 12.00,
                        stock: 75,
                        minStock: 10,
                        status: 'available',
                        prepTime: 8,
                        weight: 200,
                        calories: 320,
                        imageUrl: 'https://dummyimage.com/100x100/e76f51/fff&text=بطاطس',
                        featured: false,
                        tags: ['بطاطس', 'مقلية', 'جانبي'],
                        rating: 4.2,
                        reviews: 89,
                        soldCount: 567
                    },
                    {
                        id: 'I003',
                        name: 'كولا كلاسيك',
                        category: 'drinks',
                        description: 'مشروب غازي منعش وبارد',
                        price: 8.00,
                        stock: 100,
                        minStock: 20,
                        status: 'available',
                        prepTime: 2,
                        weight: 330,
                        calories: 140,
                        imageUrl: 'https://dummyimage.com/100x100/2a9d8f/fff&text=كولا',
                        featured: false,
                        tags: ['مشروب', 'غازي', 'كولا'],
                        rating: 4.0,
                        reviews: 45,
                        soldCount: 789
                    },
                    {
                        id: 'I004',
                        name: 'شاورما لحم عربي',
                        category: 'food',
                        description: 'شاورما لحم طازج مع صوص الطحينة والسلطة',
                        price: 18.00,
                        stock: 25,
                        minStock: 5,
                        status: 'available',
                        prepTime: 12,
                        weight: 280,
                        calories: 380,
                        imageUrl: 'https://dummyimage.com/100x100/264653/fff&text=شاورما',
                        featured: true,
                        tags: ['شاورما', 'لحم', 'عربي'],
                        rating: 4.7,
                        reviews: 98,
                        soldCount: 156
                    }
                ]);
                
                this.merchantItems.set('M002', [
                    {
                        id: 'I005',
                        name: 'أرز بسمتي فاخر',
                        category: 'food',
                        description: 'أرز بسمتي عطري من أجود الأنواع - كيس 5 كيلو',
                        price: 45.00,
                        stock: 30,
                        minStock: 5,
                        status: 'available',
                        prepTime: 0,
                        weight: 5000,
                        calories: 205,
                        imageUrl: 'https://dummyimage.com/100x100/f77f00/fff&text=أرز',
                        featured: true,
                        tags: ['أرز', 'بسمتي', 'حبوب'],
                        rating: 4.7,
                        reviews: 67,
                        soldCount: 123
                    },
                    {
                        id: 'I006',
                        name: 'زيت زيتون بكر ممتاز',
                        category: 'food',
                        description: 'زيت زيتون عضوي بكر ممتاز - عبوة 500 مل',
                        price: 35.00,
                        stock: 15,
                        minStock: 3,
                        status: 'available',
                        prepTime: 0,
                        weight: 500,
                        calories: 884,
                        imageUrl: 'https://dummyimage.com/100x100/fcbf49/fff&text=زيت',
                        featured: false,
                        tags: ['زيت', 'زيتون', 'طبخ'],
                        rating: 4.8,
                        reviews: 34,
                        soldCount: 89
                    },
                    {
                        id: 'I007',
                        name: 'شاي أحمد الإنجليزي',
                        category: 'drinks',
                        description: 'شاي أحمد الأصلي من سريلانكا - علبة 100 كيس',
                        price: 22.00,
                        stock: 40,
                        minStock: 8,
                        status: 'available',
                        prepTime: 0,
                        weight: 200,
                        calories: 2,
                        imageUrl: 'https://dummyimage.com/100x100/d62828/fff&text=شاي',
                        featured: false,
                        tags: ['شاي', 'أحمد', 'سريلانكا'],
                        rating: 4.4,
                        reviews: 52,
                        soldCount: 234
                    }
                ]);
                
                this.merchantItems.set('M003', [
                    {
                        id: 'I008',
                        name: 'فيتامينات متعددة للكبار',
                        category: 'medicine',
                        description: 'مكمل غذائي يحتوي على فيتامينات ومعادن أساسية - 60 قرص',
                        price: 45.00,
                        stock: 25,
                        minStock: 5,
                        status: 'available',
                        prepTime: 0,
                        weight: 100,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/003049/fff&text=فيتامين',
                        featured: true,
                        tags: ['فيتامينات', 'مكمل', 'صحة'],
                        rating: 4.6,
                        reviews: 78,
                        soldCount: 156
                    },
                    {
                        id: 'I009',
                        name: 'كريم مرطب للبشرة الجافة',
                        category: 'medicine',
                        description: 'كريم طبي مرطب للبشرة الجافة والحساسة - 100 مل',
                        price: 28.00,
                        stock: 18,
                        minStock: 4,
                        status: 'available',
                        prepTime: 0,
                        weight: 120,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/457b9d/fff&text=كريم',
                        featured: false,
                        tags: ['كريم', 'مرطب', 'بشرة'],
                        rating: 4.3,
                        reviews: 45,
                        soldCount: 89
                    },
                    {
                        id: 'I010',
                        name: 'مسكن الآلام باراسيتامول',
                        category: 'medicine',
                        description: 'أقراص باراسيتامول لتسكين الآلام وخفض الحرارة - 20 قرص',
                        price: 8.50,
                        stock: 60,
                        minStock: 15,
                        status: 'available',
                        prepTime: 0,
                        weight: 50,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/1d3557/fff&text=دواء',
                        featured: false,
                        tags: ['مسكن', 'باراسيتامول', 'ألم'],
                        rating: 4.1,
                        reviews: 23,
                        soldCount: 345
                    }
                ]);
                
                this.merchantItems.set('M004', [
                    {
                        id: 'I011',
                        name: 'باقة ورد أحمر فاخرة',
                        category: 'gifts',
                        description: 'باقة من 12 وردة حمراء طازجة مع تغليف فاخر',
                        price: 85.00,
                        stock: 12,
                        minStock: 2,
                        status: 'available',
                        prepTime: 30,
                        weight: 400,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/e63946/fff&text=ورد',
                        featured: true,
                        tags: ['ورد', 'باقة', 'هدية'],
                        rating: 4.9,
                        reviews: 67,
                        soldCount: 89
                    },
                    {
                        id: 'I012',
                        name: 'علبة شوكولاتة بلجيكية',
                        category: 'gifts',
                        description: 'علبة شوكولاتة بلجيكية فاخرة مع تشكيلة متنوعة',
                        price: 55.00,
                        stock: 20,
                        minStock: 4,
                        status: 'available',
                        prepTime: 5,
                        weight: 250,
                        calories: 520,
                        imageUrl: 'https://dummyimage.com/100x100/6f4e37/fff&text=شوكولاتة',
                        featured: true,
                        tags: ['شوكولاتة', 'بلجيكي', 'فاخر'],
                        rating: 4.7,
                        reviews: 89,
                        soldCount: 156
                    }
                ]);
                
                this.merchantItems.set('M005', [
                    {
                        id: 'I013',
                        name: 'سماعات لاسلكية آبل AirPods',
                        category: 'electronics',
                        description: 'سماعات آبل AirPods Pro اللاسلكية مع خاصية إلغاء الضوضاء',
                        price: 899.00,
                        stock: 8,
                        minStock: 2,
                        status: 'available',
                        prepTime: 0,
                        weight: 45,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/000000/fff&text=AirPods',
                        featured: true,
                        tags: ['سماعات', 'آبل', 'لاسلكي'],
                        rating: 4.8,
                        reviews: 234,
                        soldCount: 67
                    },
                    {
                        id: 'I014',
                        name: 'شاحن سريع لاسلكي',
                        category: 'electronics',
                        description: 'شاحن لاسلكي سريع 15W متوافق مع جميع الهواتف الذكية',
                        price: 120.00,
                        stock: 15,
                        minStock: 3,
                        status: 'available',
                        prepTime: 0,
                        weight: 200,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/4c956c/fff&text=شاحن',
                        featured: false,
                        tags: ['شاحن', 'لاسلكي', 'سريع'],
                        rating: 4.4,
                        reviews: 123,
                        soldCount: 234
                    }
                ]);
                
                this.merchantItems.set('M006', [
                    {
                        id: 'I015',
                        name: 'بطاقة رهان رياضي',
                        category: 'sports',
                        description: 'بطاقة رهان على المباريات الرياضية المحلية والعالمية',
                        price: 50.00,
                        stock: 100,
                        minStock: 20,
                        status: 'available',
                        prepTime: 1,
                        weight: 5,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/2d6a4f/fff&text=رهان',
                        featured: true,
                        tags: ['رهان', 'رياضة', 'مباراة'],
                        rating: 4.2,
                        reviews: 456,
                        soldCount: 1234
                    }
                ]);
                
                this.merchantItems.set('M007', [
                    {
                        id: 'I016',
                        name: 'قهوة عربية أصيلة',
                        category: 'drinks',
                        description: 'قهوة عربية محمصة طازجة مع الهيل والزعفران',
                        price: 15.00,
                        stock: 30,
                        minStock: 8,
                        status: 'available',
                        prepTime: 5,
                        weight: 150,
                        calories: 5,
                        imageUrl: 'https://dummyimage.com/100x100/8b4513/fff&text=قهوة',
                        featured: true,
                        tags: ['قهوة', 'عربية', 'هيل'],
                        rating: 4.8,
                        reviews: 189,
                        soldCount: 345
                    },
                    {
                        id: 'I017',
                        name: 'حلويات شرقية مشكلة',
                        category: 'food',
                        description: 'تشكيلة حلويات شرقية مميزة - بقلاوة، كنافة، قطايف',
                        price: 35.00,
                        stock: 20,
                        minStock: 5,
                        status: 'available',
                        prepTime: 10,
                        weight: 500,
                        calories: 450,
                        imageUrl: 'https://dummyimage.com/100x100/daa520/fff&text=حلويات',
                        featured: true,
                        tags: ['حلويات', 'شرقية', 'بقلاوة'],
                        rating: 4.6,
                        reviews: 78,
                        soldCount: 123
                    }
                ]);
                
                this.merchantItems.set('M008', [
                    {
                        id: 'I018',
                        name: 'عباءة نسائية عصرية',
                        category: 'other',
                        description: 'عباءة نسائية أنيقة من القماش الراقي مع تطريز ذهبي',
                        price: 280.00,
                        stock: 12,
                        minStock: 2,
                        status: 'available',
                        prepTime: 0,
                        weight: 600,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/2c2c54/fff&text=عباءة',
                        featured: true,
                        tags: ['عباءة', 'نسائية', 'أنيقة'],
                        rating: 4.7,
                        reviews: 45,
                        soldCount: 67
                    },
                    {
                        id: 'I019',
                        name: 'حجاب حريري ملون',
                        category: 'other',
                        description: 'حجاب من الحرير الطبيعي بألوان متدرجة جميلة',
                        price: 45.00,
                        stock: 25,
                        minStock: 5,
                        status: 'available',
                        prepTime: 0,
                        weight: 50,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/9b59b6/fff&text=حجاب',
                        featured: false,
                        tags: ['حجاب', 'حرير', 'ملون'],
                        rating: 4.5,
                        reviews: 67,
                        soldCount: 134
                    }
                ]);
                
                this.merchantItems.set('M009', [
                    {
                        id: 'I020',
                        name: 'مقياس ضغط دم رقمي',
                        category: 'medicine',
                        description: 'جهاز قياس ضغط الدم الرقمي الأوتوماتيكي مع شاشة كبيرة',
                        price: 180.00,
                        stock: 8,
                        minStock: 2,
                        status: 'available',
                        prepTime: 0,
                        weight: 800,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/34495e/fff&text=مقياس',
                        featured: true,
                        tags: ['مقياس', 'ضغط', 'رقمي'],
                        rating: 4.4,
                        reviews: 34,
                        soldCount: 56
                    }
                ]);
                
                this.merchantItems.set('M010', [
                    {
                        id: 'I021',
                        name: 'لعبة ألغاز تعليمية للأطفال',
                        category: 'gifts',
                        description: 'لعبة ألغاز خشبية تعليمية تنمي ذكاء الطفل - مناسبة للأعمار 3-8 سنوات',
                        price: 65.00,
                        stock: 15,
                        minStock: 3,
                        status: 'available',
                        prepTime: 0,
                        weight: 400,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/f39c12/fff&text=ألغاز',
                        featured: true,
                        tags: ['ألغاز', 'تعليمية', 'أطفال'],
                        rating: 4.6,
                        reviews: 23,
                        soldCount: 45
                    },
                    {
                        id: 'I022',
                        name: 'مكعبات بناء ذكية',
                        category: 'gifts',
                        description: 'مجموعة مكعبات بناء ذكية مع تطبيق تفاعلي - 200 قطعة',
                        price: 120.00,
                        stock: 10,
                        minStock: 2,
                        status: 'available',
                        prepTime: 0,
                        weight: 1200,
                        calories: 0,
                        imageUrl: 'https://dummyimage.com/100x100/3498db/fff&text=مكعبات',
                        featured: true,
                        tags: ['مكعبات', 'بناء', 'ذكية'],
                        rating: 4.8,
                        reviews: 18,
                        soldCount: 23
                    }
                ]);
            }

            applyFilters() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const statusFilter = document.getElementById('statusFilter').value;
                const categoryFilter = document.getElementById('categoryFilter').value;
                const ratingFilter = document.getElementById('ratingFilter').value;
                const sortBy = document.getElementById('sortBy').value;

                this.filteredMerchants = this.merchants.filter(merchant => {
                    const matchesSearch = !searchTerm || 
                        merchant.name.toLowerCase().includes(searchTerm) ||
                        merchant.phone.includes(searchTerm) ||
                        merchant.id.toLowerCase().includes(searchTerm);

                    const matchesStatus = !statusFilter || merchant.status === statusFilter;
                    const matchesCategory = !categoryFilter || merchant.category === categoryFilter;
                    const matchesRating = !ratingFilter || merchant.rating >= parseFloat(ratingFilter);

                    return matchesSearch && matchesStatus && matchesCategory && matchesRating;
                });

                // Sort results
                this.sortMerchants(sortBy);
                
                this.currentPage = 1;
                this.renderMerchants();
                this.updateFilteredCount();
            }

            sortMerchants(sortBy) {
                this.filteredMerchants.sort((a, b) => {
                    switch(sortBy) {
                        case 'name':
                            return a.name.localeCompare(b.name);
                        case 'rating':
                            return b.rating - a.rating;
                        case 'orders':
                            return b.orders - a.orders;
                        case 'joinDate':
                            return b.joinDate - a.joinDate;
                        case 'lastActive':
                            return b.lastActive - a.lastActive;
                        default:
                            return 0;
                    }
                });
            }

            renderMerchants() {
                const tbody = document.getElementById('merchantsTableBody');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageData = this.filteredMerchants.slice(startIndex, endIndex);

                tbody.innerHTML = pageData.map(merchant => this.createMerchantRow(merchant)).join('');
                this.renderPagination();
            }

            createMerchantRow(merchant) {
                const statusBadge = this.getStatusBadge(merchant.status);
                const categoryBadge = this.getCategoryBadge(merchant.category);
                
                return `
                    <tr>
                        <td><input type="checkbox" class="form-check-input" value="${merchant.id}"></td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="avatar-circle bg-primary text-white me-3">
                                    ${merchant.name.charAt(0)}
                                </div>
                                <div>
                                    <strong>${merchant.name}</strong><br>
                                    <small class="text-muted">رقم التاجر: #${merchant.id}</small><br>
                                    <small class="text-muted">${merchant.owner}</small>
                                </div>
                            </div>
                        </td>
                        <td>${categoryBadge}</td>
                        <td>
                            <strong>${merchant.phone}</strong><br>
                            <small class="text-muted">${merchant.email}</small>
                        </td>
                        <td>
                            <strong class="text-primary">${merchant.orders}</strong><br>
                            <small class="text-muted">هذا الشهر</small>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="text-warning me-1">⭐</span>
                                <strong>${merchant.rating}</strong>
                                <small class="text-muted">(${merchant.reviews})</small>
                            </div>
                        </td>
                        <td>${statusBadge}</td>
                        <td>
                            <small class="text-muted">${this.formatLastActive(merchant.lastActive)}</small>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-primary" onclick="merchantManager.viewMerchant('${merchant.id}')" title="عرض التفاصيل">
                                    <span class="material-icons-outlined">visibility</span>
                                </button>
                                <button class="btn btn-outline-warning" onclick="merchantManager.editMerchant('${merchant.id}')" title="تعديل">
                                    <span class="material-icons-outlined">edit</span>
                                </button>
                                <button class="btn btn-outline-info" onclick="merchantManager.sendNotification('${merchant.id}')" title="إرسال إشعار">
                                    <span class="material-icons-outlined">notifications</span>
                                </button>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                        <span class="material-icons-outlined">more_vert</span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="merchantManager.viewOrders('${merchant.id}')">عرض الطلبات</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="merchantManager.viewAnalytics('${merchant.id}')">الإحصائيات</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item text-warning" href="#" onclick="merchantManager.suspendMerchant('${merchant.id}')">تعليق الحساب</a></li>
                                        <li><a class="dropdown-item text-danger" href="#" onclick="merchantManager.deleteMerchant('${merchant.id}')">حذف</a></li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
            }

            renderCardView() {
                const container = document.getElementById('merchantsCardContainer');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageData = this.filteredMerchants.slice(startIndex, endIndex);

                container.innerHTML = pageData.map(merchant => this.createMerchantCard(merchant)).join('');
            }

            createMerchantCard(merchant) {
                const statusBadge = this.getStatusBadge(merchant.status);
                const categoryBadge = this.getCategoryBadge(merchant.category);
                
                return `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card merchant-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="avatar-circle bg-primary text-white me-3">
                                        ${merchant.name.charAt(0)}
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-0">${merchant.name}</h6>
                                        <small class="text-muted">#${merchant.id}</small>
                                    </div>
                                    ${statusBadge}
                                </div>
                                
                                <div class="mb-2">${categoryBadge}</div>
                                
                                <div class="row text-center mb-3">
                                    <div class="col-4">
                                        <strong class="text-primary">${merchant.orders}</strong><br>
                                        <small class="text-muted">طلبات</small>
                                    </div>
                                    <div class="col-4">
                                        <strong class="text-warning">${merchant.rating}</strong><br>
                                        <small class="text-muted">تقييم</small>
                                    </div>
                                    <div class="col-4">
                                        <strong class="text-success">${merchant.reviews}</strong><br>
                                        <small class="text-muted">مراجعة</small>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-outline-primary btn-sm" onclick="merchantManager.viewMerchant('${merchant.id}')">
                                        <span class="material-icons-outlined me-1">visibility</span>
                                        عرض
                                    </button>
                                    <button class="btn btn-outline-warning btn-sm" onclick="merchantManager.editMerchant('${merchant.id}')">
                                        <span class="material-icons-outlined me-1">edit</span>
                                        تعديل
                                    </button>
                                    <button class="btn btn-outline-info btn-sm" onclick="merchantManager.sendNotification('${merchant.id}')">
                                        <span class="material-icons-outlined me-1">notifications</span>
                                        إشعار
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            getStatusBadge(status) {
                const statusConfig = {
                    online: { class: 'bg-success', text: 'متصل', icon: 'wifi' },
                    offline: { class: 'bg-secondary', text: 'غير متصل', icon: 'wifi_off' },
                    suspended: { class: 'bg-warning text-dark', text: 'معلق', icon: 'pause' },
                    pending: { class: 'bg-info', text: 'قيد المراجعة', icon: 'schedule' }
                };
                
                const config = statusConfig[status] || statusConfig.offline;
                return `
                    <span class="badge ${config.class}">
                        <span class="material-icons-outlined me-1" style="font-size: 14px;">${config.icon}</span>
                        ${config.text}
                    </span>
                `;
            }

            getCategoryBadge(category) {
                const categoryConfig = {
                    restaurant: { class: 'bg-info', text: 'مطعم' },
                    store: { class: 'bg-success', text: 'متجر' },
                    pharmacy: { class: 'bg-danger', text: 'صيدلية' },
                    giftshop: { class: 'bg-warning text-dark', text: 'محل هدايا' },
                    electronics: { class: 'bg-primary', text: 'إلكترونيات' },
                    betshop: { class: 'bg-secondary', text: 'محل رهانات' }
                };
                
                const config = categoryConfig[category] || { class: 'bg-light text-dark', text: 'أخرى' };
                return `<span class="badge ${config.class}">${config.text}</span>`;
            }

            formatLastActive(date) {
                const now = new Date();
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);

                if (minutes < 5) return 'الآن';
                if (minutes < 60) return `منذ ${minutes} دقيقة`;
                if (hours < 24) return `منذ ${hours} ساعة`;
                return `منذ ${days} يوم`;
            }

            updateStatistics() {
                document.getElementById('activeMerchantsCount').innerText = this.merchants.length;
                document.getElementById('onlineMerchantsCount').innerText = this.merchants.filter(m => m.status === 'online').length;
                document.getElementById('totalOrdersCount').innerText = this.merchants.reduce((sum, m) => sum + m.orders, 0);
                document.getElementById('averageRating').innerText = (this.merchants.reduce((sum, m) => sum + m.rating, 0) / this.merchants.length).toFixed(1);
            }

            updateFilteredCount() {
                document.getElementById('filteredCount').innerText = this.filteredMerchants.length;
            }

            viewMerchant(id) {
                const merchant = this.merchants.find(m => m.id === id);
                if (!merchant) return;

                document.getElementById('merchantDetailsContent').innerHTML = `
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-4">
                                <h5>معلومات التاجر</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>اسم المتجر:</strong> ${merchant.name}</p>
                                        <p><strong>اسم المالك:</strong> ${merchant.owner}</p>
                                        <p><strong>رقم الهاتف:</strong> ${merchant.phone}</p>
                                        <p><strong>البريد الإلكتروني:</strong> ${merchant.email}</p>
                                        <p><strong>فئة النشاط:</strong> ${this.getCategoryBadge(merchant.category)}</p>
                                        <p><strong>نسبة عمولة المنصة:</strong> <span class="badge bg-info">${merchant.commission || 0}%</span>
                                            <button class="btn btn-sm btn-outline-secondary ms-2" onclick="merchantManager.showCommissionEdit('${merchant.id}')">
                                                <span class="material-icons-outlined" style="font-size:16px;">edit</span>
                                            </button>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>العنوان:</strong> ${merchant.address}</p>
                                        <p><strong>إجمالي الطلبات:</strong> ${merchant.orders}</p>
                                        <p><strong>متوسط التقييم:</strong> ${merchant.rating} (${merchant.reviews} تقييم)</p>
                                        <p><strong>الحالة:</strong> ${this.getStatusBadge(merchant.status)}</p>
                                        <p><strong>آخر نشاط:</strong> ${this.formatLastActive(merchant.lastActive)}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5>منتجات المتجر</h5>
                                    <button class="btn btn-primary" onclick="merchantManager.viewAllItems('${merchant.id}')">
                                        <span class="material-icons-outlined me-1">inventory</span>
                                        عرض جميع المنتجات
                                    </button>
                                </div>
                                <div id="quickItemsPreview">
                                    ${this.getQuickItemsPreview(merchant.id)}
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">إجراءات سريعة</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary" onclick="merchantManager.viewAllItems('${merchant.id}')">
                                            <span class="material-icons-outlined me-1">inventory</span>
                                            إدارة المنتجات
                                        </button>
                                        <button class="btn btn-outline-success" onclick="merchantManager.viewOrders('${merchant.id}')">
                                            <span class="material-icons-outlined me-1">receipt_long</span>
                                            عرض الطلبات
                                        </button>
                                        <button class="btn btn-outline-info" onclick="merchantManager.viewAnalytics('${merchant.id}')">
                                            <span class="material-icons-outlined me-1">analytics</span>
                                            التقارير والإحصائيات
                                        </button>
                                        <button class="btn btn-outline-warning" onclick="merchantManager.sendNotification('${merchant.id}')">
                                            <span class="material-icons-outlined me-1">notifications</span>
                                            إرسال إشعار
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="merchantManager.suspendMerchant('${merchant.id}')">
                                            <span class="material-icons-outlined me-1">block</span>
                                            تعليق الحساب
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                new bootstrap.Modal(document.getElementById('merchantDetailsModal')).show();
            }
            
            getQuickItemsPreview(merchantId) {
                const items = this.merchantItems.get(merchantId) || [];
                if (items.length === 0) {
                    return '<p class="text-muted">لا توجد منتجات متاحة</p>';
                }
                
                const topItems = items.slice(0, 3);
                return topItems.map(item => `
                    <div class="d-flex align-items-center mb-2 p-2 border rounded">
                        <img src="${item.imageUrl}" alt="${item.name}" class="me-3" style="width: 50px; height: 50px; object-fit: cover;">
                        <div class="flex-grow-1">
                            <h6 class="mb-1">${item.name}</h6>
                            <div class="d-flex justify-content-between">
                                <span class="text-primary">${item.price} ر.س</span>
                                <span class="badge ${item.status === 'available' ? 'bg-success' : 'bg-warning'}">${item.status === 'available' ? 'متاح' : 'غير متاح'}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            viewAllItems(merchantId) {
                this.currentMerchantId = merchantId;
                const merchant = this.merchants.find(m => m.id === merchantId);
                document.getElementById('merchantItemsModal').querySelector('.modal-title').innerText = `منتجات ${merchant.name}`;
                this.renderMerchantItems(merchantId);
                new bootstrap.Modal(document.getElementById('merchantItemsModal')).show();
            }
            
            renderMerchantItems(merchantId) {
                const items = this.merchantItems.get(merchantId) || [];
                const tbody = document.getElementById('merchantItemsTableBody');
                
                tbody.innerHTML = items.map(item => `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${item.imageUrl}" alt="${item.name}" class="me-3" style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;">
                                <div>
                                    <strong>${item.name}</strong><br>
                                    <small class="text-muted">${item.description}</small>
                                </div>
                            </div>
                        </td>
                        <td><span class="badge bg-info">${this.getCategoryName(item.category)}</span></td>
                        <td><strong class="text-success">${item.price} ر.س</strong></td>
                        <td>
                            <strong>${item.stock}</strong><br>
                            <small class="text-muted">الحد الأدنى: ${item.minStock}</small>
                        </td>
                        <td><span class="badge ${this.getItemStatusClass(item.status)}">${this.getItemStatusText(item.status)}</span></td>
                        <td>
                            <span class="text-warning">⭐</span>
                            <strong>${item.rating}</strong>
                            <small class="text-muted">(${item.reviews})</small>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="merchantManager.editItem('${item.id}')">
                                    <span class="material-icons-outlined" style="font-size: 16px;">edit</span>
                                </button>
                                <button class="btn btn-outline-danger" onclick="merchantManager.deleteItem('${item.id}')">
                                    <span class="material-icons-outlined" style="font-size: 16px;">delete</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }
            
            getCategoryName(category) {
                const categories = {
                    'food': 'طعام',
                    'drinks': 'مشروبات',
                    'medicine': 'أدوية',
                    'electronics': 'إلكترونيات',
                    'gifts': 'هدايا',
                    'sports': 'رياضة',
                    'other': 'أخرى'
                };
                return categories[category] || 'غير محدد';
            }
            
            getItemStatusClass(status) {
                const classes = {
                    'available': 'bg-success',
                    'out_of_stock': 'bg-warning',
                    'discontinued': 'bg-danger'
                };
                return classes[status] || 'bg-secondary';
            }
            
            getItemStatusText(status) {
                const texts = {
                    'available': 'متاح',
                    'out_of_stock': 'نفذ المخزون',
                    'discontinued': 'متوقف'
                };
                return texts[status] || 'غير محدد';
            }
            
                       
            showCommissionEdit(merchantId) {
                const merchant = this.merchants.find(m => m.id === merchantId);
                const newCommission = prompt(`تعديل نسبة العمولة للتاجر ${merchant.name}\nالنسبة الحالية: ${merchant.commission}%\nأدخل النسبة الجديدة:`, merchant.commission);
                
                if (newCommission !== null && !isNaN(newCommission) && newCommission >= 0 && newCommission <= 100) {
                    merchant.commission = parseFloat(newCommission);
                    alert(`تم تحديث نسبة العمولة إلى ${newCommission}%`);
                    this.viewMerchant(merchantId); // Refresh the modal
                }
            }
            
            sendNotification(merchantId) {
                const merchant = this.merchants.find(m => m.id === merchantId);
                const message = prompt(`إرسال إشعار إلى ${merchant.name}\nاكتب رسالة الإشعار:`);
                
                if (message) {
                    alert(`تم إرسال الإشعار بنجاح إلى ${merchant.name}`);
                }
            }
            
            viewOrders(merchantId) {
                const merchant = this.merchants.find(m => m.id === merchantId);
                alert(`عرض طلبات ${merchant.name}\nهذه الوظيفة قيد التطوير...`);
            }
            
            viewAnalytics(merchantId) {
                const merchant = this.merchants.find(m => m.id === merchantId);
                alert(`تقارير وإحصائيات ${merchant.name}\nهذه الوظيفة قيد التطوير...`);
            }
            
            suspendMerchant(merchantId) {
                const merchant = this.merchants.find(m => m.id === merchantId);
                if (confirm(`هل تريد تعليق حساب ${merchant.name}؟`)) {
                    merchant.status = 'suspended';
                    alert(`تم تعليق حساب ${merchant.name}`);
                    this.renderMerchants();
                    bootstrap.Modal.getInstance(document.getElementById('merchantDetailsModal')).hide();
                }
            }
            
            editMerchant(merchantId) {
                alert('وظيفة تعديل التاجر قيد التطوير...');
            }
            
            deleteMerchant(merchantId) {
                const merchant = this.merchants.find(m => m.id === merchantId);
                if (confirm(`هل تريد حذف التاجر ${merchant.name} نهائياً؟\nهذا الإجراء لا يمكن التراجع عنه.`)) {
                    this.merchants = this.merchants.filter(m => m.id !== merchantId);
                    this.applyFilters();
                    alert(`تم حذف التاجر ${merchant.name}`);
                }
            }
            
            editItem(itemId) {
                alert('وظيفة تعديل المنتج قيد التطوير...');
            }
            
            deleteItem(itemId) {
                if (confirm('هل تريد حذف هذا المنتج؟')) {
                    // Remove item from merchant items
                    for (let [merchantId, items] of this.merchantItems.entries()) {
                        const index = items.findIndex(item => item.id === itemId);
                        if (index !== -1) {
                            items.splice(index, 1);
                            this.renderMerchantItems(merchantId);
                            break;
                        }
                    }
                    alert('تم حذف المنتج بنجاح');
                }
            }
            
            renderPagination() {
                const totalPages = Math.ceil(this.filteredMerchants.length / this.itemsPerPage);
                const pagination = document.getElementById('pagination');
                
                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }
                
                let paginationHTML = '';
                
                // Previous button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="merchantManager.goToPage(${this.currentPage - 1})">السابق</a>
                    </li>
                `;
                
                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === this.currentPage || i === 1 || i === totalPages || (i >= this.currentPage - 1 && i <= this.currentPage + 1)) {
                        paginationHTML += `
                            <li class="page-item ${i === this.currentPage ? 'active' : ''}">
                                <a class="page-link" href="#" onclick="merchantManager.goToPage(${i})">${i}</a>
                            </li>
                        `;
                    } else if (i === this.currentPage - 2 || i === this.currentPage + 2) {
                        paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                    }
                }
                
                // Next button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="merchantManager.goToPage(${this.currentPage + 1})">التالي</a>
                    </li>
                `;
                
                pagination.innerHTML = paginationHTML;
            }
            
            goToPage(page) {
                const totalPages = Math.ceil(this.filteredMerchants.length / this.itemsPerPage);
                if (page >= 1 && page <= totalPages) {
                    this.currentPage = page;
                    this.renderMerchants();
                    if (document.getElementById('cardView').checked) {
                        this.renderCardView();
                    }
                }
            }
        }
        
        // Initialize the merchant manager
        const merchantManager = new MerchantManager();
        
        // Global functions
        function exportMerchants() {
            alert('تصدير البيانات قيد التطوير...');
        }
        
        function downloadMerchantApp() {
            alert('تحميل تطبيق التجار قيد التطوير...');
        }
        
        function showAddMerchantModal() {
            new bootstrap.Modal(document.getElementById('addMerchantModal')).show();
        }
        
        function showMerchantDetails(merchantId) {
            const merchant = merchantManager.merchants.find(m => m.id === merchantId);
            if (merchant) {
                // Update modal with merchant details
                document.getElementById('merchantDetailsModal').querySelector('.modal-title').textContent = `تفاصيل التاجر - ${merchant.name}`;
                
                // Show merchant items
                const items = merchantManager.merchantItems.get(merchantId) || [];
                const itemsContainer = document.getElementById('merchantItemsList');
                if (itemsContainer) {
                    itemsContainer.innerHTML = items.map(item => `
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <img src="${item.imageUrl}" class="card-img-top" style="height: 150px; object-fit: cover;">
                                <div class="card-body">
                                    <h6 class="card-title">${item.name}</h6>
                                    <p class="card-text small">${item.description}</p>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-primary fw-bold">${item.price} ر.س</span>
                                        <span class="badge ${item.status === 'available' ? 'bg-success' : 'bg-warning'}">${item.status === 'available' ? 'متاح' : 'غير متاح'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
                
                new bootstrap.Modal(document.getElementById('merchantDetailsModal')).show();
            }
        </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>